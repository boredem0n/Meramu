<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meramu App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/phosphor-icons"></script>
    <script>
        // Custom Tailwind configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark-green': '#102820',
                        'brand-hunter-green': '#4C6444',
                        'brand-khaki': '#CABA9C',
                        'brand-umber': '#8A6240',
                        'brand-cafe-noir': '#4D2D18',
                        'brand-bg': '#F7F5F2' // Lighter khaki for background
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide scrollbar for cleaner look */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Custom modal styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-brand-bg">

    <div id="app" class="max-w-sm mx-auto bg-white min-h-screen shadow-lg">
        <!-- Main App Content -->
        <main id="main-content" class="pb-20">
            <!-- All pages will be rendered here -->
        </main>

        <!-- Floating Cart Bar -->
        <div id="floating-cart-bar" class="fixed bottom-16 max-w-sm w-full p-3 bg-brand-dark-green text-white hidden z-40">
             <div class="flex justify-between items-center">
                <div>
                    <p id="floating-cart-items" class="font-bold">1 Item</p>
                    <p id="floating-cart-total" class="text-sm">Rp 15,000</p>
                </div>
                <button onclick="navigateTo('cart')" class="bg-brand-hunter-green font-bold px-6 py-2 rounded-lg">Pay Now</button>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="fixed bottom-0 max-w-sm mx-auto w-full bg-white border-t border-gray-200 flex justify-around items-center h-16 z-50">
            <button onclick="navigateTo('home')" class="text-center text-gray-600 hover:text-brand-hunter-green transition-colors">
                <i class="ph-house text-2xl"></i>
                <span class="text-xs block">Home</span>
            </button>
            <button onclick="navigateTo('voucher')" class="text-center text-gray-600 hover:text-brand-hunter-green transition-colors">
                <i class="ph-ticket text-2xl"></i>
                <span class="text-xs block">Voucher</span>
            </button>
            <button onclick="navigateTo('racikan')" class="text-center">
                 <div class="bg-brand-hunter-green text-white rounded-full w-16 h-16 flex items-center justify-center -mt-8 border-4 border-white shadow-md">
                    <i class="ph-flask text-3xl"></i>
                </div>
            </button>
            <button onclick="navigateTo('orderHistory')" class="text-center text-gray-600 hover:text-brand-hunter-green transition-colors">
                <i class="ph-receipt text-2xl"></i>
                <span class="text-xs block">Order</span>
            </button>
            <button onclick="navigateTo('account')" class="text-center text-gray-600 hover:text-brand-hunter-green transition-colors">
                <i class="ph-user text-2xl"></i>
                <span class="text-xs block">Account</span>
            </button>
        </nav>
        
        <!-- Custom Alert Modal -->
        <div id="custom-alert-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] opacity-0 pointer-events-none">
            <div class="modal-content bg-white rounded-lg p-6 text-center shadow-xl transform scale-95">
                <p id="custom-alert-message" class="mb-4 text-brand-cafe-noir"></p>
                <button onclick="hideCustomAlert()" class="bg-brand-hunter-green text-white px-6 py-2 rounded-lg">OK</button>
            </div>
        </div>

    </div>

    <script>
        const mainContent = document.getElementById('main-content');
        // --- GLOBAL STATE ---
        let cart = [];
        let orderHistory = [
            { id: 'ORD001', status: 'Pesanan sedang diantar', items: [{ name: 'Jahe Wangi', quantity: 2 }], total: 20000 },
            { id: 'ORD002', status: 'Si Mbok sedang menyiapkan pesanan', items: [{ name: 'Es Kopi Kayu Manis', quantity: 1 }, { name: 'Panada', quantity: 1 }], total: 30000 },
            { id: 'ORD003', status: 'Pesanan sudah dibayar', items: [{ name: 'Jamu Racikan Sendiri', quantity: 1 }], total: 18000 }
        ];
        let subtotal = 0;
        let deliveryFee = 0;
        let deliveryType = 'pickup';
        let deliveryAddress = null;

        // --- DATA ---
        const products = {
            panas: [
                { id: 1, name: 'Jahe Wangi', price: 10000, img: 'https://placehold.co/150x150/a855f7/white?text=Jahe+Wangi' },
                { id: 2, name: 'Kopi Tubruk', price: 8000, img: 'https://placehold.co/150x150/f97316/white?text=Kopi+Tubruk' },
                { id: 3, name: 'Wedang Bolique', price: 12000, img: 'https://placehold.co/150x150/14b8a6/white?text=Wedang+B' },
                { id: 4, name: 'Wedang Secang', price: 11000, img: 'https://placehold.co/150x150/ec4899/white?text=Wedang+S' },
            ],
            dingin: [
                { id: 5, name: 'Kunir Asem', price: 8000, img: 'https://placehold.co/150x150/f59e0b/white?text=Kunir+Asem' },
                { id: 6, name: 'Beras Kencur', price: 8000, img: 'https://placehold.co/150x150/84cc16/white?text=Beras+Kencur' },
                { id: 7, name: 'Es Teh Sereh', price: 7500, img: 'https://placehold.co/150x150/10b981/white?text=Es+Teh+Sereh' },
                { id: 8, name: 'Es Kopi Kayu Manis', price: 15000, img: 'https://placehold.co/150x150/6366f1/white?text=Es+Kopi' },
            ],
            kudapan: [
                { id: 9, name: 'Panada (isi 3)', price: 15000, img: 'https://placehold.co/150x150/ef4444/white?text=Panada' },
                { id: 10, name: 'Timus Ubi Ungu', price: 12000, img: 'https://placehold.co/150x150/8b5cf6/white?text=Timus' },
                { id: 11, name: 'Pisang Epe', price: 10000, img: 'https://placehold.co/150x150/eab308/white?text=Pisang+Epe' },
            ]
        };
        
        const racikanOptions = {
            temperature: [{ name: 'Iced', price: 0 }, { name: 'Hot', price: 3000 }],
            base: [{ name: 'Water', price: 0 }, { name: 'Teh', price: 2000 }, { name: 'Kopi', price: 5000 }, { name: 'Fresh Milk', price: 3000 }, { name: 'Soy Milk', price: 7000 }, { name: 'Susu Almond', price: 7000 }],
            size: [{ name: 'Regular', price: 0 }, { name: 'Xtra', price: 5000 }],
            herbs: [{ name: 'Jahe', price: 1000 }, { name: 'Kencur', price: 1000 }, { name: 'Kunir', price: 1000 }, { name: 'Temulawak', price: 1500 }, { name: 'Cengkeh', price: 1500 }, { name: 'Sereh', price: 1000 }, { name: 'Kayu Manis', price: 2000 }, { name: 'Secang', price: 1500 }, { name: 'Sambiloto', price: 2000 }],
            sugar: [{ name: 'No Sugar', price: 0 }, { name: 'White Sugar', price: 0 }, { name: 'Palm Sugar', price: 0 }, { name: 'Diabetic Sugar', price: 5000 }],
            addMore: [{ name: 'Espresso Shot', price: 5000 }, { name: 'Manuka Honey', price: 3000 }]
        };
        let currentRacikan = {};
        
        const mockAddresses = [{ address: 'Simpang Lima, Semarang', distance: 4.5 }, { address: 'Lawang Sewu, Semarang', distance: 6.2 }, { address: 'Jatingaleh, Semarang', distance: 16.0 }];
        
        // --- HELPER FUNCTIONS ---
        function showCustomAlert(message) {
            const modal = document.getElementById('custom-alert-modal');
            document.getElementById('custom-alert-message').innerText = message;
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('.modal-content').classList.remove('scale-95');
        }

        function hideCustomAlert() {
            const modal = document.getElementById('custom-alert-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.querySelector('.modal-content').classList.add('scale-95');
        }
        
        function updateFloatingCart() {
            const bar = document.getElementById('floating-cart-bar');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const currentTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (totalItems > 0) {
                document.getElementById('floating-cart-items').innerText = `${totalItems} Item${totalItems > 1 ? 's' : ''}`;
                document.getElementById('floating-cart-total').innerText = `Rp ${currentTotal.toLocaleString('id-ID')}`;
                bar.classList.remove('hidden');
            } else {
                bar.classList.add('hidden');
            }
        }

        function addToCart(customizedProduct) {
            const optionsId = customizedProduct.options.map(opt => `${opt.type}:${opt.value}`).sort().join('|');
            const uniqueId = `${customizedProduct.id}-${optionsId}`;
            const existingItem = cart.find(item => item.uniqueId === uniqueId);

            if (existingItem) {
                existingItem.quantity += customizedProduct.quantity;
            } else {
                cart.push({ ...customizedProduct, uniqueId });
            }
            
            updateFloatingCart();
            showCustomAlert(`${customizedProduct.quantity}x ${customizedProduct.name} added to cart!`);
        }
        
        function finalizeOrder() {
            if (cart.length === 0) {
                showCustomAlert("Your cart is empty.");
                return;
            }
            const newOrder = {
                id: `ORD00${orderHistory.length + 1}`,
                status: 'Pesanan sudah dibayar',
                items: cart.map(item => ({ name: item.name, quantity: item.quantity })),
                total: subtotal + (deliveryFee > 0 ? deliveryFee : 0)
            };
            orderHistory.unshift(newOrder); // Add to the top of the history
            cart = []; // Clear the cart
            updateFloatingCart();
            showCustomAlert("Payment successful! Your order has been placed.");
            navigateTo('orderHistory');
        }
        
        // --- PAGE TEMPLATES ---

        function homePage() {
            return `
                <div class="p-4 bg-brand-bg">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <div class="text-2xl font-bold text-brand-dark-green">Meramu</div>
                            <p class="text-brand-cafe-noir">Hi, User!</p>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center gap-2 bg-brand-umber text-white font-bold py-1 px-3 rounded-full">
                                <i class="ph-star-fill"></i>
                                <span>0 Pts</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-brand-hunter-green text-white rounded-lg p-6 mb-6 text-center shadow-lg">
                        <h2 class="font-bold text-xl mb-2">Monday Discount</h2>
                        <p>Buy 1 Get 1 for Es Kopi Kayu Manis!</p>
                    </div>
                    <h3 class="font-bold text-lg mb-3 text-brand-cafe-noir">Category</h3>
                    <div class="grid grid-cols-4 gap-4 text-center mb-6">
                        <div onclick="navigateTo('category', 'panas')" class="cursor-pointer">
                            <div class="bg-white rounded-lg p-3 mb-1 flex items-center justify-center h-16 shadow"><i class="ph-coffee text-3xl text-brand-hunter-green"></i></div>
                            <span class="text-sm text-brand-cafe-noir">Panas</span>
                        </div>
                        <div onclick="navigateTo('category', 'dingin')" class="cursor-pointer">
                            <div class="bg-white rounded-lg p-3 mb-1 flex items-center justify-center h-16 shadow"><i class="ph-brandy text-3xl text-brand-hunter-green"></i></div>
                            <span class="text-sm text-brand-cafe-noir">Dingin</span>
                        </div>
                        <div onclick="navigateTo('category', 'kudapan')" class="cursor-pointer">
                            <div class="bg-white rounded-lg p-3 mb-1 flex items-center justify-center h-16 shadow"><i class="ph-cookie text-3xl text-brand-hunter-green"></i></div>
                            <span class="text-sm text-brand-cafe-noir">Kudapan</span>
                        </div>
                         <div onclick="navigateTo('recipe')" class="cursor-pointer">
                            <div class="bg-white rounded-lg p-3 mb-1 flex items-center justify-center h-16 shadow"><i class="ph-notebook text-3xl text-brand-hunter-green"></i></div>
                            <span class="text-sm text-brand-cafe-noir">Recipe</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-lg text-brand-cafe-noir">Popular!</h3>
                        <div onclick="navigateTo('bot')" class="bg-brand-umber text-white px-4 py-2 rounded-full flex items-center gap-2 cursor-pointer shadow">
                           <i class="ph-robot"></i>
                           <span>Konsul Si Mbok</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 pb-24">
                        ${products.dingin.map(p => `
                            <div class="bg-white rounded-lg shadow p-2" onclick="navigateTo('product', {type: 'dingin', id: ${p.id}})">
                                <img src="${p.img}" alt="${p.name}" class="rounded-md w-full h-24 object-cover mb-2">
                                <h4 class="font-semibold text-brand-cafe-noir">${p.name}</h4>
                                <p class="text-brand-umber">Rp ${p.price.toLocaleString('id-ID')}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function categoryPage(category) {
             const categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);
            const productList = products[category];

            return `
                <div class="p-4 bg-brand-bg">
                    <div class="flex items-center mb-4">
                        <button onclick="navigateTo('home')" class="mr-4 text-brand-dark-green"><i class="ph-arrow-left text-2xl"></i></button>
                        <h2 class="font-bold text-xl text-brand-dark-green">${categoryTitle}</h2>
                    </div>
                    <div class="grid grid-cols-2 gap-4 pb-24">
                        ${(productList || []).map(p => `
                            <div class="bg-white rounded-lg shadow p-3 text-center cursor-pointer" onclick="navigateTo('product', {type: '${category}', id: ${p.id}})">
                                <img src="${p.img}" alt="${p.name}" class="rounded-md w-full h-24 object-cover mb-2">
                                <h4 class="font-semibold text-brand-cafe-noir">${p.name}</h4>
                                <p class="text-brand-umber">Rp ${p.price.toLocaleString('id-ID')}</p>
                                <button class="mt-2 bg-brand-hunter-green text-white w-full py-1 rounded-lg font-semibold">+</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function productPage(params) {
             const { type, id } = params;
            const product = products[type].find(p => p.id === id);
            
            window.currentProductState = { quantity: 1, basePrice: product.price, totalPrice: product.price };

            window.updateProductPrice = () => {
                let newPrice = currentProductState.basePrice;
                const options = [];
                const size = document.querySelector('input[name="size"]:checked');
                if (size) { if(size.dataset.price) newPrice += parseInt(size.dataset.price); options.push({ type: 'Size', value: size.dataset.label }); }
                const sugar = document.querySelector('input[name="sugar"]:checked');
                if (sugar) { if(sugar.dataset.price) newPrice += parseInt(sugar.dataset.price); options.push({ type: 'Sugar', value: sugar.dataset.label }); }
                const sugarLevel = document.querySelector('input[name="sugar-level"]:checked');
                if (sugarLevel) { options.push({ type: 'Level', value: sugarLevel.dataset.label }); }
                const addOns = document.querySelectorAll('input[name="addon"]:checked');
                addOns.forEach(addon => { newPrice += parseInt(addon.dataset.price); options.push({ type: 'Add-on', value: addon.dataset.label }); });
                currentProductState.totalPrice = newPrice;
                currentProductState.options = options;
                document.getElementById('product-price').innerText = `Rp ${currentProductState.totalPrice.toLocaleString('id-ID')}`;
                document.getElementById('add-to-cart-btn').innerText = `Add to Cart - Rp ${(currentProductState.totalPrice * currentProductState.quantity).toLocaleString('id-ID')}`;
            };

            window.changeProductQuantity = (amount) => {
                if (currentProductState.quantity + amount >= 1) {
                    currentProductState.quantity += amount;
                    document.getElementById('product-quantity').innerText = currentProductState.quantity;
                    updateProductPrice();
                }
            };
            
            window.finalizeAddToCart = () => {
                const finalProduct = { id: product.id, name: product.name, quantity: currentProductState.quantity, price: currentProductState.totalPrice, options: currentProductState.options };
                addToCart(finalProduct);
            };

            setTimeout(updateProductPrice, 0); 

            return `
                <div class="relative bg-brand-bg">
                    <div class="p-4 flex items-center absolute top-0 left-0 w-full bg-gradient-to-b from-black/50 to-transparent z-10">
                        <button onclick="navigateTo('category', '${type}')" class="mr-4 text-white"><i class="ph-arrow-left text-2xl"></i></button>
                    </div>
                    <img src="${product.img.replace('150x150', '400x300')}" alt="${product.name}" class="w-full h-60 object-cover">
                    <div class="px-4 pt-4 bg-white rounded-t-2xl -mt-4 relative">
                        <h2 class="font-bold text-2xl mb-1 text-brand-dark-green">${product.name}</h2>
                        <p id="product-price" class="text-xl font-semibold text-brand-hunter-green mb-6">Rp ${product.price.toLocaleString('id-ID')}</p>
                        ${type !== 'kudapan' ? `
                        <div class="mb-4"><h3 class="font-semibold mb-2 text-brand-cafe-noir">Size